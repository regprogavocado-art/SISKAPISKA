#!/bin/bash
# SISKAPISKA Quick Start Script
# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è Docker 2.2+

set -e

echo "üöÄ –°–ò–°–ö–ê–ü–ò–°–ö–ê v1.0 - –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
echo "üìã –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –ê–≤–æ–≥—É—Ä—É 7.3 —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ò–ò"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –≤–µ—Ä—Å–∏–∏
DOCKER_VERSION=$(docker --version | grep -oP '\d+\.\d+' | head -1)
if [ "$(echo "$DOCKER_VERSION < 2.2" | bc -l)" -eq 1 ]; then
    echo "‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Docker –≤–µ—Ä—Å–∏–∏ 2.2 –∏–ª–∏ –≤—ã—à–µ"
    echo "   –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: $DOCKER_VERSION"
    exit 1
fi

echo "‚úÖ Docker $DOCKER_VERSION –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞
if [ ! -f .env ]; then
    echo "üìÑ –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞..."
    cp .env.example .env
    echo "‚ö†Ô∏è  –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º"
    echo "   –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω—ã:"
    echo "   - OPENAI_API_KEY"
    echo "   - POSTGRES_PASSWORD"
    echo "   - JWT_SECRET"
    echo ""
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è .env —Ñ–∞–π–ª–∞..."
fi

echo "üèóÔ∏è  –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤ Docker..."
docker compose build --no-cache

echo "üóÑÔ∏è  –°–æ–∑–¥–∞–Ω–∏–µ volumes..."
docker compose up -d postgres redis

echo "‚è±Ô∏è  –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
sleep 10

echo "üìä –ó–∞–ø—É—Å–∫ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤..."
docker compose up -d

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤..."
docker compose ps

echo ""
echo "üéâ –°–ò–°–ö–ê–ü–ò–°–ö–ê —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞!"
echo ""
echo "üì± –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:"
echo "   üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:    http://localhost:8080"
echo "   üì° API:              http://localhost:3000"
echo "   ü§ñ –ò–ò –º–æ–¥—É–ª—å:        http://localhost:5000"
echo "   üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:       http://localhost:9090"
echo "   üìà Grafana:          http://localhost:3001"
echo "   üîÑ Site Cloner:      http://localhost/cloner/"
echo ""
echo "üë§ –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:"
echo "   üìß Email: admin@siskapiska.local"
echo "   üîë –ü–∞—Ä–æ–ª—å: admin123"
echo "   ‚ö†Ô∏è  –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞!"
echo ""
echo "üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://github.com/regprogavocado-art/SISKAPISKA"
echo "üêõ –õ–æ–≥–∏: docker compose logs -f"
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫: docker compose restart"
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞: docker compose down"
echo ""
echo "üéØ –û—Å–Ω–æ–≤–Ω–æ–π workflow:"
echo "   1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á–∏ –≤ .env"
echo "   2. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω—ã —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"
echo "   3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ ISPmanager –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é"
echo "   4. –í–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é"
echo ""
echo "‚ú® –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:"
echo "   ‚Ä¢ –ê–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞ –¥–æ–º–µ–Ω–æ–≤ (GoDaddy/Namecheap)"
echo "   ‚Ä¢ –ò–ò –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (OpenAI GPT-4)"
echo "   ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (ISPmanager)"
echo "   ‚Ä¢ Site Cloner –Ω–∞ –±–∞–∑–µ SeoDor"
echo "   ‚Ä¢ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≤–µ–±-—Å–∫—Ä–∞–ø–∏–Ω–≥"
echo "   ‚Ä¢ Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
echo ""
echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è!"
echo "   –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–∞—Ö"
echo "   –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø—ã"
echo "   –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã API –∫–ª—é—á–µ–π"
echo ""